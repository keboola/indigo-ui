language: node_js

services:
  - docker

node_js: "8"

install:
  - yarn

jobs:
  include:
    - stage: test
      script:
        - >-
          yarn stylelint
          && yarn test
          && yarn build-dev-css
          && yarn build-storybook

    - stage: deploy storybook
      script:
        - >-
          yarn build-storybook
          && ./deploy-storybook.sh
      if: branch = master AND NOT tag IS present

    - stage: build library and deploy
      script:
        - yarn build-lib
      before_deploy:
        - ls -1
      deploy:
        - provider: npm
          email: ujovlado+npm@rekurzia.sk
          api_key:
            secure: "Nni4pkTB5XMpRo4/l4HKXCtQjDbWD3rbpEOg/VPr38bIIebrhLzrooHjvIkWBvM/MeHw18g7F6EOsAgp3/qralDgAFYIKeL76pk2k5nbR0pthWLFNgEKwusbV2P8kbmjwcH1PTVzlfiiX3ZDmyDrEo8vfXmVEMvwmt3oUA7Xf/jl9D3zwU4m4aH1RGAAYu0tWDYjPbLqRHCc7oD5LUPu2OLn4S54i41KUTGHjHTFIkbxi4w85sZ1tWAKbaxe9kEVyPXuZ44W2twXELNLkSuB/TF6qtC9Vt9EHNSQjaVMapNnBYrhAsQ0fN5R2SrfGe60oAOubuCE3pIBnDn/1fqGLLW9UPLe0aoibcHUUEHus/v2c2up8mDdSpqjCbfs6BzwaiN6KGDKDoBQt9cEyLrOFnB/D+SVzUmZUCquyAKwvuOGjJFtRAvIP07KpfiyClPMYaYMDWSq9uzp68zmK4Jc5YToMOhZIhQ53upk6A7IRV7WIPfyysWzlMIKPmIQTJrk3YT1Y4cFvh9rg+O5nNx4I7d0iHeSdOVA2ot3RjO8RE5k+AMWUTz3fXC5OczzDbU1tNpdB4IkQors056BJ8s5oyrlfVShjbftHwgqUP8oH+kNN+J//Nv7CcxbVn2d7MQ4SZPawByQ2Gbx0jv752c70ocnAqRCd6+pbgJ9q4RbJzo="
          skip_cleanup: true
          on:
            tags: true
            repo: keboola/indigo-ui
            branch: master
      if: tag IS present

cache: yarn

notifications:
  slack:
    secure: Y3EKCFrnGFfT+ntkTkETnVkCzC1p1E8er6QagLd6zP87d5vh+SxDLruWeExMSmVWf9uTTTuEQJcEc4zPXfMoxYwu70moDMuJrO3x1FPJbiXbv3e8jX7R1M/rYGpGbATUhoyfc0ifcQf/ug6EupvA9GTwMX3iU8UejlgO3G0qDAdLks5DbCGQjBtEO281/KovRXLYEnw+Yv0pusHEaPrBrnuZN3HM2XXOzv6CXRaQ5TJM2BnGSfBZ7w1Kp0ym/D4zhZKrPorIkqni7/LPV4/Qi2g5zxtLjmtRRccaWr6cDXpZh27qN5CKy9B9qJjrQAkitwuc0XOWNXpnupUj01koqRAHJIKEsRYjNq2w6gSv1kVWUfQErKL0q7PQc7AGGv/BuM88/fZRnFrNglOvFsfjZB2Aee2bcoFG4eOCckC3ufrTn5tBc2nuhdpj2H/YCcGusyDF+pjH2hsexT4dpGbo7lkajfAkrf2OnjeLZjCrE+TpDh9KNzPTv4nEt1JkcU1BQnIsyOJCBGZF8H63yQq+rkevftwFVOPBEsUPpbG4L6O+fnshsM9X2LNJahu0dHnK+lFO1lp2l7DKSDiSyhkjXa7Fc7plp01DON3w1Ph1kFDJYCHfuDsPo1HMBOWhQ3b8WbtO2PiqrNwx6QAQh5g6DAwh+eMOmZ1LcOLstJtM/Oo=
  email: false
