const fs = require('fs');
const path = require('path');
const prettier = require('prettier');

const iconsDir = path.resolve(__dirname + '/indigo/components/icons');
const iconsFile = iconsDir + '/index.js';

fs.readdir(iconsDir, function (err, files) {
  const components = [];
  files.forEach(function(file) {
    if (file !== 'index.js' && path.extname(file) === '.js') {
      components.push(path.basename(file, '.js'))
    }
  });

  let fileImports = '';
  components.forEach(function(component) {
    fileImports += `import ${component} from './${component}';\n`;
  });

  let fileAssignments = '';
  components.forEach(function(component) {
    fileAssignments += `  ${component},\n`;
  });

  const fileContent = `// Autogenerated file. Check generate-icons-index.js
${fileImports}
const Icon = {
${fileAssignments}};
export default Icon;
`;

  const formattedContent = prettier.format(fileContent, {
    singleQuote: true,
    trailingComma: 'es5'
  });

  fs.writeFile(iconsFile, formattedContent, (err) => {
    if (err) {
      throw err;
    }
    console.log(`File ${iconsFile} has been created!`);
  });
});
